\documentclass[12pt,oneside]{book}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{lmodern}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage[dvipsnames]{xcolor}
\usepackage[bf,sf,small,pagestyles]{titlesec}
\usepackage{titling}
\usepackage[font={footnotesize, sf}, labelfont=bf]{caption} 
\usepackage{siunitx}
\usepackage{graphicx}
\usepackage{tikz-cd}
\usepackage{booktabs}
\usepackage{amsmath,amssymb}
\usepackage[sort]{cleveref}
\usepackage{amsthm,thmtools}
\usepackage[shortlabels]{enumitem}
\usepackage{todonotes}

\geometry{
	a4paper,
	right = 3cm,
	left = 3cm,
	bottom = 3cm,
	top = 3cm
}

\hypersetup{
	colorlinks,
	linkcolor = {red!50!blue},
	linktoc = page
}
\newcommand{\locallabel}[1]{\label{\currentprefix:#1}}
\newcommand{\localref}[1]{\ref{\currentprefix:#1}}
\newcommand{\localcref}[1]{\cref{\currentprefix:#1}}

\numberwithin{table}{section}
\numberwithin{equation}{section}
\numberwithin{figure}{section}

\newcommand{\qedtriangle}{\ensuremath{\triangle}}
\newcommand{\qedtriangledown}{\ensuremath{\bigtriangledown}}
\declaretheoremstyle[spaceabove=6pt, spacebelow=6pt, headfont=\bfseries, notefont=\normalfont, notebraces={(}{)}, qed=\qedtriangle]{definition}
\declaretheoremstyle[spaceabove=6pt, spacebelow=6pt, headfont=\bfseries, notefont=\normalfont, notebraces={(}{)}, qed=\qedtriangledown]{example}

\declaretheorem[name=Theorem, refname={theorem,theorems}, Refname={Theorem,Theorem}, numberwithin=chapter]{theorem}
\declaretheorem[name=Proposition, refname={proposition,propositions}, Refname={Proposition,Propositions}, numberlike=theorem]{proposition}
\declaretheorem[name=Lemma, refname={lemma,lemmata}, Refname={Lemma,Lemmata}, numberlike=theorem]{lemma}
\declaretheorem[name=Corollary, refname={corollary,corollaries}, Refname={Corollary,Corollaries}, numberlike=theorem]{corollary}
\declaretheorem[name=Definition, style=definition, refname={definition,definitions}, Refname={Definitio,Definitions}, numberwithin=chapter]{definition}
\declaretheorem[name=Example, style=example, refname={example,examples}, Refname={Example,Examples}, numberwithin=chapter]{example}

\newlist{points}{enumerate}{1}
\setlist[points,1]{label=\textup{(}{\itshape \roman*}\textup{)}, wide}

\graphicspath{{./figs/}}

% Unitats
\sisetup{
	inter-unit-product = \ensuremath{ \cdot },
	allow-number-unit-breaks = true,
	detect-family = true,
	list-final-separator = { and },
	list-units = single
}

\renewcommand{\vec}[1]{\mathbf{#1}}
\newcommand{\rest}[1]{\raisebox{-.5ex}{$|$}_{#1}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\B}{\mathcal{B}}
\newcommand{\M}{\mathcal{M}}
\renewcommand{\P}{\mathcal{P}}
\newcommand{\id}{\mathrm{id}}
\newcommand{\abs}[1]{\lvert #1 \rvert}
\newcommand{\ext}[1]{m^* \! \left( #1 \right)}  
\newcommand{\parbreak}{
	\begin{center}
		--- $\ast$ ---
	\end{center} 
}
\makeatletter
\newcommand*{\defeq}{\mathrel{\rlap{%
    \raisebox{0.3ex}{$\m@th\cdot$}}%
  \raisebox{-0.3ex}{$\m@th\cdot$}}%
	=
}
\makeatother

\newpagestyle{page}[\sffamily \footnotesize]{
	\headrule
	\sethead*{\ifthesection{{\bfseries \thesection} \sectiontitle}{}}{}{{\bfseries Chapter \thechapter.} \chaptertitle}
	\footrule
	\setfoot*{}{}{\thepage}
}
\renewpagestyle{plain}[\sffamily \footnotesize]{
	\footrule
	\setfoot*{}{}{\thepage}
}
\assignpagestyle{\chapter}{plain}

\titleformat{\chapter}[block]{\sffamily \bfseries \Huge}{\filleft \large Chapter \Huge \thechapter\\}{0pt}{\Huge \titlerule[1pt] \vspace{1ex} \filleft}

\title{Real Analysis}
\author{Arnau Mas}
\date{2019}

\begin{document}
\maketitle

\frontmatter
\pagestyle{plain}
These are notes gathered during the subject \emph{Anàlisi Real i Funcional} as taught by Joan Orobitg between September 2019 and January 2020.

\mainmatter

\chapter{Measure Theory}
\section{Measure spaces}
\begin{definition}[\( \sigma \)-algebra]
	We say a family of subsets \( \A \subseteq \P(X) \) of a set \( X \) is a \( \sigma \)-algebra over it if
	\begin{points}
	\item \( \emptyset, X \in \A \),
	\item \( \A \) is closed under countable unions, i.e. if there is a countable set \( \{ A_i \}_{i \in \N} \subseteq \A \) then \( \bigcup_{i \in \N} A_i \in \A \),
	\item \( \A \) is closed under countable intersections, i.e. if there is a countable set \( \{ A_i \}_{i \in \N} \subseteq \A \) then \( \bigcap_{i \in \N} A_i \in \A \),
	\item \( \A \) is closed under complements, i.e. if \( A \in \A \) then \( A^c \in \A \).
	\end{points}
\end{definition}
Notice that if a collection of subsets is closed under countable unions and under complements then it is also closed under intersections since by De Morgan's laws a countable intersection is the complement of the union of complements. Similarly if it is closed under intersections and complements it is closed under unions. So when showing that a certain collection is a \( \sigma \)-algebra it is enough to show that is closed under one of unions or intersections.

\begin{example}
	The following are all examples of \( \sigma \)-algebras.
	\begin{points}
	\item For any set \( X \), \( \P(X) \) is a \( \sigma \)-algebra called the \emph{discrete \( \sigma \)-algebra}. It is the \emph{finest} \( \sigma \)-algebra since any other possible \( \sigma \)-algebra over \( X \) is contained in it.
	\item On the other hand, the \emph{coarsest} \( \sigma \)-algebra over any set \( X \) is simply \( \{ \emptyset, X \} \), meaning any other possible \( \sigma \)-algebra contains it. It is called the \emph{trivial \( \sigma \)-algebra}.
	\item If \( \A_1 \) and \( \A_2 \) are \( \sigma \)-algebras over a set \( X \) then so is \( \A_1 \cap \A_2 \).
	\item Given a family of subsets \( S \subseteq \P(X) \) then the \( \sigma \)-algebra generated by it is the intersection of all \( \sigma \)-algebras that contain it and it is the smallest \( \sigma \)-algebra that contains \( S \). We write it \( \sigma(S) \).
	\item The \emph{Borel \( \sigma \)-algebra} over a topological space \( X \) is the \( \sigma \)-algebra generated by the open sets of \( X \), written \( \B(X) \). Since a closed set is the complement of an open set the family of closed sets also generates the Borel \( \sigma \)-algebra.
	\end{points}
\end{example}
The pair formed by a set and its \( \sigma \)-algebra is called a \emph{measurable space}.

\begin{definition}[Measure]
	Let \( (X,\A) \) be a measurable space. A measure is a map \( \mu \colon A \to [0,\infty] \) such that the following are true
	\begin{points}
	\item \( \mu(\emptyset) = 0 \).
	\item If \( \{ A_i \}_{i \in \N} \subseteq \A \) is a family of pairwise disjoint sets of finite measure then
		\begin{equation*}
			\mu\left(\bigcup_{i \in \N} A_i\right) = \sum_{i \in \N} \mu(A_i). 
		\end{equation*}
	\end{points}
\end{definition}
A measurable space equipped with a measure is called a \emph{measure space}.

\begin{example}
	The following are all examples of measures.
	\begin{points}
	\item Consider a measurable space \( X \) with the discrete \( \sigma \)-algebra. Then, for any subset \( A \subseteq X \) we define \( \mu(A) = \abs{A} \) if \( A \) is finite and \( \mu(A) = \infty \) if \( A \) is infinite. This is the \emph{counting measure}, for obvious reasons.
	\item On a finite measurable space \( X \) with the discrete \( \sigma \)-algebra we define for any subset \( A \subseteq X \)
		\begin{equation*}
			\mu(A) = \frac{\abs{A}}{\abs{X}}.
		\end{equation*}
		This is a special case of a probability measure since \( \mu(X) = 1 \). In fact a probability is exactly a measure satisfying \( \mu(X) = 1 \).
	\item On a measurable space \( X \) with any \( \sigma \)-algebra fix a point \( x \in X \) and define \( \mu(A) = 1 \) if \( x \in A \) and \( \mu(A) = 0 \) otherwise. This is called the \emph{Dirac measure}.
	\end{points}
\end{example}

\section{The Lebesgue measure}
A question worth asking is whether any measurable space can be made into a measure space. Caratheódory's extension theorem gives an affirmative answer to the question provided we give a starting point for the measure. Roughly speaking the starting point consists of specifying the measure of a collection of subsets, subject to some requirements, which can then be extended to a measure on the whole of the \( \sigma \)-algebra. In this section we explore a particular case of this construction on \( \R^n \) which is known as the \emph{Lebesgue measure}.

The main motivation behind the Lebesgue measure is to rigorously generalise the idea of length ---in the case of \( \R \)---, area ---in the case of \( \R^2 \)--- and volume ---in the case of \( \R^n \)--- to arbitrary dimension and for as many subsets as possible. The starting point will be the rectangles (segments in \( \R \), rectangles in \( \R^2 \), prisms in \( \R^3 \)--- for which their volume is clear: it is simply the product of the length of the sides. 

\subsection{The Lebesgue exterior measure}
As we said, the starting point for the construction will be rectangles. Let's lay down the precise definitions.
\begin{definition}[Interval]
	An \emph{interval} \( I \) is a subset of \( \R \) with the property that if \( a, b \in I \) then \( c \in I \) whenever \( a < c < b \). It can be shown that if an interval is bounded then it must be one of \( [a,b] \), \( (a,b) \), \( [a,b) \) or \( (a,b] \). \( a \) and \( b \) are called the \emph{endpoints} of the interval and we will write \( \langle a,b \rangle \) for any interval with endpoints \( a \) and \( b \).

The length of an interval with endpoints \( a \) and \( b \) is defined to be \( \abs{b - a} \).
\end{definition}

\begin{definition}[Rectangle]
	An (\( n \)-dimensional) \emph{rectangle} \( R \) is the product of \( n \) intervals, that is
	\begin{equation*}
		R = \langle a_1, b_1 \rangle \times \cdots \times \langle a_n, b_n \rangle.
	\end{equation*}
	The \emph{volume} of a rectangle is defined to be
	\begin{equation*}
		v(R) = \abs{b_1 - a_1} \cdot \cdots \cdot \abs{b_n - a_n}.
	\end{equation*}
\end{definition}
These two definitions of (hopefully) clear concepts are perhaps needlessly fussy but it pays to be precise in the beginning.

\begin{definition}[Exterior measure]
	We define the \emph{Lebesgue exterior measure} or simply \emph{exterior measure} as
	\begin{equation*}
		\inf \left\{ \sum_{j = 1}^{\infty} v(R_j) \mid A \subseteq \bigcup_{j = 1}^{\infty}R_j \text{, }R_j\text{ rectangles} \right\}.
	\end{equation*}
	We will denote it by \( \ext{A} \).
\end{definition}
The intuition behind the exterior measure is as follows: given any set, cover it with rectangles and add up their volumes. Then try to refine the covering by acheiving less total area. The infimimum of the volumes of all possible covers is the exterior measure. In two dimensions this describes trying to literally cover the set by a patchwork of rectangles finer and finer that approximates the area of the set in question.

Also, given that the volume of a rectangle is always positive, the set we are taking the infimum of is bounded below by zero and so its infimimum always exists and is non-negative. Thus the exterior measure exists for any set. 

\begin{example}
	It is impractical to use the definition to directly compute the exterior measure of a given set. However here we calculate the exterior measure of various classes of sets which constitute relatively easy examples.
	\begin{points}
	\item The exterior measure of a point is 0. Indeed, let \( a \in \R^n \) and consider the square of center \( a \) and side \( \epsilon \), \( Q_\epsilon(a) \)\footnote{More precisely, if \( a = (a_1, \cdots, a_n) \) then \( Q_\epsilon(a) = (a_1 - \frac{\epsilon}{2}, a_1 + \frac{\epsilon}{2}) \times \cdots \times (a_1 - \frac{\epsilon}{2}, a_1 + \frac{\epsilon}{2}) \).}. Then \( Q_\epsilon(a) \) is certainly a cover of \( \{ a\} \) and has volume \( \epsilon^n \). That is, \( \ext{\{ a \}} \leq \epsilon^n \). Since \( \epsilon \) can be as small as we wish we conclude \( \ext{\{ a \}} = 0 \).

	\item A segment in \( \R^n \) (with \( n > 1 \)) has exterior measure 0. If the segment has length \( L \) then we can cover it with a rectangle of length \( L \) and whose all other sides have length \( \delta \). Then its total volume is \( L\delta^{n-1} \) and the exterior measure of the segment is bounded by it. And since \( \delta \) can be made as small as we want, we conclude the exterior measure must be 0. The details of the proof are a little cumbersome but the idea is hopefully clear.

	\item In general any (sufficiently well-behaved) bounded subset of a hyperspace of dimension \( k \) inside \( \R^n \) with \( k < n \) has zero exterior measure. The idea is a generalisation of the previous two examples: the set can be covered by an \( n \)-dimensional hypercube in such a way that \( n - k \) of its sides can be shrunk as much as one whishes and so the total volume of the cube goes to zero. Again, this is a little handwavy but the argument can be made precise. 

	\item Any countable set set of \( \R^n \) has zero exterior measure. Since a countable set is a countable union of points, cover one of the points with a square of volume \( \frac{\epsilon}{2} \), the next one with a square of volume \( \frac{\epsilon}{4} \), the following with a square of volume \( \frac{\epsilon}{8} \) and so on. The total volume of the cover is
		\begin{equation*}
			\sum_{n = 1}^{\infty} \frac{\epsilon}{2^n} = \epsilon 
		\end{equation*}
		which can be made as small as one wishes.
	\end{points}
\end{example}

\begin{lemma} \label{lemma:exterior measure with open sets}
	The exterior measure of any set is the same even if only open covers are considered.
\end{lemma}
\begin{proof}
	Let's for the moment write \( M^*(A) \) for the outer measure of a set considering only open covers. It is clear that \( \ext{A} \leq M^*(A) \) since a cover with open rectangles of \( A \) is still a cover by rectangles of \( A \) and so \( M^\ast(A) \) should be at least as big as \( \ext{A} \).

	Now we prove the reverse inequality, \( M^\ast(A) \leq \ext{A} \). If \( \{ R_i \}_{i = 1}^{\infty} \) is a cover of \( A \) by rectangles then
	\begin{equation*}
		\sum_{i = 1}^{\infty} v(R_i) = \sum_{i = 1}^{\infty} v(\mathring{R}_i)  
	\end{equation*}
	since a rectangle and its interior have the same endpoints. In general, however, it is not the case that
	\begin{equation*}
		\bigcup_{i = 1}^{\infty} R_i \subseteq \bigcup_{i = 1}^{\infty} \mathring{R}_i
	\end{equation*}
	since the interior of a set is contained in the set itself and not the other way (as should be the case) and in fact we might not even cover \( A \) anymore.

	To mend this we can simply dilate the interiors. In detail, given a rectangle \( R = \langle a_1, b_1 \rangle \times \cdots \times \langle a_n,b_n \rangle \) to be
	\begin{equation*}
		\lambda R = \lambda \langle a_1, b_1 \rangle \times \cdots \times \lambda \langle a_n,b_n \rangle
	\end{equation*}
	where by definition
	\begin{equation*}
		\lambda \langle a, b \rangle = \left\langle \frac{a+b}{2} - \lambda \frac{b - a}{2}, \frac{a + b}{2} + \lambda\frac{b - a}{2} \right\rangle.
	\end{equation*}
	This is all a very complicated way of saying we slightly inflate the rectangles while keeping their centers the same. It should be clear that if \( \lambda > 1 \) then \( R \subseteq \lambda \mathring{R} \) and \( v(\lambda R) = \lambda^n v(R) \). And so
	\begin{equation*}
		A \subseteq \bigcup_{i = 1}^{\infty} R_i \subseteq \bigcup_{i = 1}^{\infty} \lambda \mathring{R}_i.
	\end{equation*}
	Then, since \( \{ \lambda \mathring{R}_j \}_{j = 1}^{\infty} \) is a cover of \( A \) by open rectangles we have
	\begin{equation*}
		M^*(A) \leq \sum_{j = 1}^{\infty} v(\lambda \mathring{R}_j) = \lambda^n \sum_{j = 1}^{\infty} v(R_j).
	\end{equation*}
	Letting \( \lambda \to 1 \) we obtain that for any cover of \( A \) by rectangles \( \{ R_j \}_{j = 1}^\infty \) then
	\begin{equation*}
		M^*(A) \leq \sum_{j = 1}^{\infty} v(R_j)
	\end{equation*}
	and so \( M^*(A) \leq \ext{A} \) as we wanted.
\end{proof}

\begin{lemma} \label{lemma:exterior measure of rectangle}
	The exterior measure of a rectangle is exactly its volume.
\end{lemma}
\begin{proof}
	Let \( R \) be a rectangle. It is clear that \( \ext{R} \leq v(R) \) since \( R \) covers itself. We need to show then that \( v(R) \leq \ext{R} \). If \( \{ R_j \}_{j = 1}^\infty \) is a cover of \( R \) then we wish to conlcude that
	\begin{equation*}
		v(R) \leq \sum_{j = 1}^{\infty}v(R_j). 
	\end{equation*}

	We can without loss of generality assume that we are dealing with a closed rectangle since \( v(R) = v(\bar{R}) \). And since rectangles are bounded they are compact. Using the previous lemma we need only consider covers by open rectangles and by compactness we can further limit our scope to finite open covers. Now all that is left is to show that if a rectangle is covered by a finite amount of other rectangles then their combined volume is greater than that of the the original rectangle. 

	Let, then, \( R = \langle a_1,b_1 \rangle \times \cdots \times \langle a_n,b_n \rangle \) be a rectangle and \( \{ R_j \}_{j = 1}^N \) be a cover of \( R \) with \( R_j = \langle a^j_1,b^j_1 \rangle \times \cdots \times \langle a^j_n,b^j_n \rangle \). Then we take the projection onto the \( i \)-th dimension and we have that
	\begin{equation*}
		\langle a_i, b_i \rangle \subseteq \bigcup_{j = 1}^N \langle a^j_i, b^j_i \rangle.
	\end{equation*}
	Let \( A_i = \min \{ a^1_i, \cdots, a^N_i \} \) and \( B_i = \max \{ b^1_i, \cdots, b^N_i \} \). Then we have \( \abs{b^j_i - a^j_i} \leq \abs{B_i - A_i} \) and \todo{Finish this proof}

	This last part of the proof consists mainly of technical details. The main insight is that since we need only look at closed rectangles and open covers then we can, by compactness, reduce potentially infinite covers to finite ones and then we can take maximums and minimums without concern.
\end{proof}

{
	\def\currentprefix{prop:properties of exterior measure}	
	\begin{proposition}[Properties of the exterior measure] \label{prop:properties of exterior measure}
		The following are some properties of the exterior measure
		\begin{points}
		\item \locallabel{i} \( \ext{\emptyset} = 0 \).
		\item \locallabel{ii} The exterior measure is increasing, that is if \( A \subseteq B \) then \( \ext{A} \leq \ext{B} \). 
		\item \locallabel{iii} The exterior measure is countably subadditive, i.e.
			\begin{equation*}
				\ext{\bigcup_{j = 1}^\infty A_j} \leq \sum_{j = 1}^{\infty} \ext{A_j}. 
			\end{equation*}
		\item \locallabel{iv} The exterior measure is invariant under translations.
		\item \locallabel{v} If \( A \subseteq \R^n \) and \( \lambda \in \R \) then \( \ext{\lambda A} = \lambda^n \ext{A} \)\footnote{The notation \( \lambda A \) does not refer to a dilation as used in the proof of \cref{lemma:exterior measure with open sets} but rather to the image of \( A \) under scalar multiplication by \( \lambda \) which is more standard.}.
		\item \locallabel{vi} If a set \( A \) satisfies \( \mathring{R} \subseteq A \subseteq \bar{R} \) for a rectangle \( R \) then \( \ext{A} = v(R) \).
		\end{points}
	\end{proposition}
	\begin{proof}
		\localref{i} follows from the fact that any cover is a cover of the empty set. \localref{ii} is because any cover of \( B \) is a cover of \( A \) so \( \ext{A} \) must be less than \( \ext{B} \).

		Proving \localref{iii} requires a bit more work. We may assume that every one of the \( A_j \) has finite exterior measure since otherwise we are dealing with a vacuous statement. Let \( \{ R_i^j \}_{i = 1}^\infty \) be a cover of \( A_j \) such that 
		\begin{equation*}
			\sum_{i = 1}^{\infty} v(R_i^j) \leq \ext{A_j} + \frac{\epsilon}{2^j}. 
		\end{equation*}
		Then
		\begin{equation*}
			\bigcup_{j=1}^\infty A_j \subseteq \bigcup_{j=1}^\infty \bigcup_{i=1}^\infty R_i^j
		\end{equation*}
		so
		\begin{equation*}
			\ext{\bigcup_{j=1}^\infty A_j} \leq \sum_{j=1}^\infty \sum_{i=1}^\infty v(R_i^j) \leq \sum_{j = 1}^{\infty} \ext{A_j} + \frac{\epsilon}{2^j} = \sum_{j = 1}^{\infty} \ext{A_j} + \epsilon.
		\end{equation*}
		And then by letting \( \epsilon \to 0 \) we obtain the countable subadditivity.	

		It should be clear that the volume of a rectangle is invariant under translations. This means that if we have a cover of a set \( A \) then we can transform it, by a translation, into a cover of the translated set \( A + x \) of the same total volume, and viceversa. And so it follows that \( \ext{A} = \ext{A + x} \). This proves \localref{iv}.

		The proof of \localref{v} is very similar. Again, it should be clear that if we scale a rectangle of dimension \( n \) by a factor of \( \lambda \) then its volume picks up a factor of \( \lambda^n \). So, given a cover of \( A \) with total volume \( V \) we can scale it by \( \lambda \) and we obtain a cover of \( \lambda A \) with volume \( \lambda^n V \), and viceversa. Thus we see that \( \ext{\lambda A} = \lambda^n \ext{A} \).

		It follows immediately from \localref{i} that \( \ext{\mathring{R}} \leq \ext{A} \leq \ext{\bar{R}} \). And then, using \cref{lemma:exterior measure of rectangle} we find \( \ext{\mathring{R}} = \ext{\bar{R}} = v(R) \) and so \( \ext{A} = v{R} \). 
	\end{proof}
}

\subsection{Measurable sets}
If the measure we are constructing is to be a useful generalization of the notion of volume we should expect the measure of the union of disjoint sets to be the sum of their measures. With the exterior measure this is the case for most well-behaved sets, but there exist counterexamples. The solution to this problem is to restrict ourselves to a smaller class of sets which we will call the measurable sets.
\begin{definition}[Measurable set]
	We say a set \( E \subseteq \R^n \) is \emph{measurable} if for any other set \( A \subseteq \R^n \) it is true that
	\begin{equation*}
		\ext{A} \geq \ext{E \cap A} + \ext{E^c \cap A}.
	\end{equation*}
The set \( A \) is sometimes called a \emph{test set}.
\end{definition}

Notice that because the exterior measure is subadditive we get the other inequality for free so we could have required equality in the definition of a measurable set without being more restrictive.

\begin{example} \label{exe:measurable sets}
	The following are various examples of measurable sets
	\begin{points}
	\item \( \R^n \) is measurable since \( \R^n \cap A = A \) and \( (\R^n)^c \cap A = \emptyset \).
	\item Similarly \( \emptyset \) is also measurable.
	\item Any set of zero exterior measure is measurable. Indeed, if \( \ext{E} = 0 \) since \( E \cap A \subseteq E \) then \( \ext{E \cap A} = 0 \) and
		\begin{equation*}
			\ext{E \cap A} + \ext{E^c \cap A} = \ext{E^c \cap A} \leq \ext{A}.
		\end{equation*}
	\end{points}
\end{example}

The collection of measurable subsets of \( \R^n \) forms a \( \sigma \)-algebra. To prove this we will first show a preliminary result. 
\begin{proposition}
	The collection of measurable subsets is stable under finite unions. Furthermore the exterior measure is finitely additive, that is if \( E_1, \cdots, E_n \) are measurable sets and are pairwise disjoint then 
	\begin{equation*}
		\ext{\bigcup_{k = 1}^n E_k} = \sum_{k = 1}^{n} \ext{E_k}. 
	\end{equation*}
\end{proposition}
\begin{proof}
	Let \( \M \) denote the set of measurable subsets of \( \R^n \). It is sufficient to show that if \( E, F \in \M \) then \(  E \cup F \in \M \) since we can then prove by induction that any finite union of measurable sets is measurable. For any \( A \subseteq \R^n \) we have
	\begin{equation*}
		\ext{A \cap (E \cup F)} + \ext{A \cap (E \cup F)^c} = \ext{(A \cap E) \cup (A \cap F)} + \ext{A \cap E^c \cap F^c}.
	\end{equation*}
	We may use the identity of sets \( (A \cap E) \cup (A \cap F) = (A \cap E) \cup (A \cap E^c \cap F) \) and subadditivity to get
	\begin{align*}
		\ext{A \cap (E \cup F)} & + \ext{A \cap (E \cup F)^c} = \\
														& = \ext{(A \cap E) \cup (A \cap E^c \cap F)} + \ext{A \cap E^c \cap F^c} \\
														& \leq \ext{A \cap E} + \ext{(A \cap E^c) \cap F} + \ext{(A \cap E^c) \cap F^c} \\
														& = \ext{A \cap E} + \ext{A \cap E^c} = \ext{A},
	\end{align*}
	where we have used the measurability of \( E \) and \( F \) in the last two steps. 

	We now prove the finite additivity. Let \( E_1, \cdots, E_n \) be pairwise disjoint measurable sets. Then using \( A \cap \left(\bigcup_{k = 1}^n	E_k\right) \) as a test set and \( E_n \) as the measurable set we have, by definition of measurability
	\begin{align*}
		\ext{A \cap \left(\bigcup_{k = 1}^n	E_k\right)} & = \ext{A \cap \left(\bigcup_{k = 1}^n	E_k\right) \cap E_n} + \ext{A \cap \left(\bigcup_{k = 1}^n	E_k\right) \cap E_n^c} \\
																										& = \ext{A \cap E_n} + \ext{A \cap \left(\bigcup_{k = 1}^{n-1}	E_k\right)}.
	\end{align*}
	By induction we find
	\begin{equation*}
		\ext{A \cap \left(\bigcup_{k = 1}^n	E_k\right)} = \sum_{k = 1}^{n} \ext{A \cap E_k} 
	\end{equation*}
	and taking \( A = \bigcup_{k = 1}^n E_k \) we obtain
	\begin{equation*}
		\ext{\bigcup_{k = 1}^n E_k} = \sum_{k = 1}^{n}\ext{E_k} 
	\end{equation*}
	as we wanted.
\end{proof}

\begin{proposition}
	The collection \( \M \) of measurable subsets of \( \R^n \) is a \( \sigma \)-algebra.
\end{proposition}
\begin{proof}
	We have already seen in \cref{exe:measurable sets} that \( \R^n \) and \( \emptyset \) are both measurable. It is also immediate that the complement of a measurable set is also measurable. All that remains to be shown is that \( \M \) is closed under countable unions. 

	Let \( \{ E_k \}_{k = 1}^\infty \) be a countable family of measurable subsets. A first observation is that we may, without loss of generality, assume that the \( E_k \) are pairwise disjoint. Indeed, define \( F_1 = E_1 \) and \( F_k = E_{k} - \bigcup_{j = 1}^{k-1}E_j \). The \( F_k \) are disjoint by construction. They are also all measurable by virtue of being finite intersections and unions of measurable sets and more importantly
	\begin{equation*}
		\bigcup_{k = 1}^\infty E_k = \bigcup_{k = 1}^\infty	F_k.
	\end{equation*}
	What this means is that any union of measurable sets is equal to the union of some other pairwise disjoint measurable sets. So if we manage to show that countable unions of pairwise disjoint measurable sets are measurable we are done. 

	Let's get to it then. We want to show that
	\begin{equation*}
		\ext{A} \geq \ext{A \cap \left(\bigcup_{k = 1}^\infty E_k\right)} + \ext{A \cap \left(\bigcup_{k = 1}^\infty E_k\right)^c}.
	\end{equation*}
	We start from the fact that finite unions of measurable sets are measurable and so for any \( n \in \N \)
	\begin{equation*}
		\ext{A} \geq \ext{A \cap \left(\bigcup_{k = 1}^n E_k\right)} + \ext{A \cap \left(\bigcup_{k = 1}^n E_k\right)^c}.
	\end{equation*}
	Now notice that 	
	\begin{equation*}
		\bigcap_{k = 1}^N E_k \subseteq \bigcap_{k = 1}^\infty E_k
	\end{equation*}
	so when we take complements the inclusion reverses and we get
	\begin{equation*}
		\left(\bigcap_{k = 1}^\infty E_k\right)^c \subseteq \left(\bigcap_{k = 1}^N E_k\right)^c.
	\end{equation*}
	Therefore
	\begin{equation*}
		\ext{A \cap \left(\bigcup_{k = 1}^n E_k\right)^c} \geq \ext{A \cap \left(\bigcup_{k = 1}^\infty E_k\right)^c}
	\end{equation*}
	which takes care of the second term.

	For the first term, we use the distributivity of intersection over unions and finite additivity ---remember we are assuming the \( E_k \) to be pairwise disjoint--- to get
	\begin{equation*}
		\ext{A \cap \left(\bigcup_{k = 1}^n E_k\right)} = \ext{\bigcup_{k = 1}^n A \cap E_k} = \sum_{k = 1}^{n} \ext{A \cap E_k}.
	\end{equation*}

	All together reads
	\begin{equation*}
		\ext{A} \geq \sum_{k = 1}^{n} \ext{A \cap E_k} + \ext{A \cap \left(\bigcup_{k = 1}^\infty E_k\right)^c}.
	\end{equation*}
	By taking the limit \( n \to \infty \) we get
	\begin{equation*}
		\ext{A} \geq \sum_{k = 1}^\infty \ext{A \cap E_k} + \ext{A \cap \left(\bigcup_{k = 1}^\infty E_k\right)^c}.
	\end{equation*}
	Finally, we use subadditivity to arrive at the desired result,
	\begin{align*}
		\ext{A} & \geq \sum_{k = 1}^\infty \ext{A \cap E_k} + \ext{A \cap \left(\bigcup_{k = 1}^\infty E_k\right)^c} \\
						& \geq \ext{\bigcup_{k = 1}^\infty A \cap E_k} + \ext{A \cap \left(\bigcup_{k = 1}^\infty E_k\right)^c} \\
						& \geq \ext{A \cap \left(\bigcup_{k = 1}^\infty E_k\right)} + \ext{A \cap \left(\bigcup_{k = 1}^\infty E_k\right)^c}.
	\end{align*}
\end{proof}

We now have a \( \sigma \)-algebra defined on \( \R^n \), which makes into a measurable space. To make it into a measure space we restrict the exterior measure to the measurable sets. We have to check that this is an honest to goodness measure. We have already seen that the measure of the empty set is 0, but we have to show that the measure is additive for disjoint unions.

\begin{proposition}
	The exterior measure of the union of disjoint sets is the sum of their measures. That is, if \( E_k \) are pairwise disjoint measurable sets then
	\begin{equation*}
		\ext{\bigcup_{k = 1}^\infty E_k} = \sum_{k = 1}^{\infty} \ext{E_k}. 
	\end{equation*}
\end{proposition}
\begin{proof}
	We showed in the proof of the previous proposition that
	\begin{equation*}
		\ext{A} \geq \sum_{k = 1}^\infty \ext{A \cap E_k} + \ext{A \cap \left(\bigcup_{k = 1}^\infty E_k\right)^c}.
	\end{equation*}
	Take as a test \( A = \bigcup_{k = 1}^\infty E_k \), then, using the fact that the \( E_k \) are pairwise disjoint,
	\begin{equation*}
		\ext{\bigcup_{k = 1}^\infty E_k} \geq \sum_{k = 1}^\infty \ext{E_k} + \ext{\emptyset} = \sum_{k = 1}^\infty \ext{E_k}.
	\end{equation*}
	The reverse inequality is a statement of subadditivity. So we get
	\begin{equation*}
		\ext{\bigcup_{k = 1}^\infty E_k} = \sum_{k = 1}^\infty \ext{E_k}.
	\end{equation*}
\end{proof}

\subsection{The structure of measurable sets}
In this section we will give a number of results that shed light into the nature of measurable sets. The \( \sigma \)-algebra \( \M \) is not exactly the Borel \( \sigma \)-algebra \( \B(\R) \). However measaurable sets are really close to Borel sets, as we will see.

{
	\def\currentprefix{theo:characterization of measurable sets}
\begin{theorem}
	For any subset \( E \subseteq \R^n \) the following are equivalent:
	\begin{points}
	\item \locallabel{i} \( E \) is measurable.
	\item \locallabel{ii} For all \( \epsilon > 0 \) there is an open set \( G_{\epsilon} \supseteq E \) such that \(  \ext{G_{\epsilon} - E} < \epsilon \).
	\item \locallabel{iii} For all \( \epsilon > 0 \) there is a closed set \( F_{\epsilon} \subseteq E \) such that \(  \ext{E - F_{\epsilon}} < \epsilon \).
	\item \locallabel{iv} For all \( \epsilon > 0 \) there are an open set \( G_{\epsilon} \) and a closed set \( F_{\epsilon} \) such that \( F_{\epsilon} \subseteq E \subseteq G_{\epsilon} \) and \( \ext{G_{\epsilon} - F_{\epsilon}} < \epsilon \).
	\end{points}
\end{theorem}
\begin{proof}
	Let's first show \localref{i}\( \implies \)\localref{ii}. We tackle first the case \( \ext{E} < \infty \). Then, by definition of the exterior measrue there is a cover of \( E \) by open rectangles, \( \{ R_j \}_{j = 1}^\infty \) such that
	\begin{equation*}
		\sum_{j = 1}^{\infty} v(R_j) < \ext{E} + \epsilon.
	\end{equation*}
	Let \( G_\epsilon = \bigcup_{j = 1}^\infty R_j \). This is an open set that contains \( E \). Then, because \( G_\epsilon = E \cup G_\epsilon - E \) we have, by additivity of the exterior measure
	\begin{equation*}
		\ext{G_\epsilon - E} = \ext{G_\epsilon} - \ext{E} \leq \sum_{j = 1}^{\infty}v(R_j) - \ext{E} < \epsilon.
	\end{equation*}

There is a usual trick to deal with the case when \( \ext{E} = \infty \). 
	
\end{proof}
}

\end{document}
